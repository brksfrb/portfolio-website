---
interface Props {
    project: {
        id: string;
        title: string;
        shortDescription: string;
        languages: string[];
        tags: string[];
        category: string;
        featured?: boolean;
        highlights?: string[];
        screenshots?: string[];
        links?: Record<string, string>;
    };
    featured?: boolean;
}

const { project, featured = false } = Astro.props;

function langClass(lang: string) {
    return 'lang-' + lang.toLowerCase().replace(/[^a-z]/g, '').replace('c++', 'cpp').replace('csharp', 'csharp');
}

const categoryIcons: Record<string, string> = {
    web: 'üåê',
    desktop: 'üñ•Ô∏è',
    game: 'üéÆ',
    ai: 'üß†',
    cv: 'üëÅÔ∏è',
    hardware: '‚ö°',
    networking: 'üîó',
    mobile: 'üì±',
    plugin: 'üß©',
};
---

<a href={`/projects/${project.id}`} class={`project-card ${featured ? 'featured' : ''} reveal`} data-category={project.category}>
    <div class="card-inner">
        <div class="card-header">
            <span class="category-icon">{categoryIcons[project.category] || 'üìÅ'}</span>
            <div class="languages">
                {project.languages.map(lang => (
                        <span class={`tag ${langClass(lang)}`}>{lang}</span>
                ))}
            </div>
        </div>

        <h3 class="card-title">{project.title}</h3>
        <p class="card-desc">{project.shortDescription}</p>

        {project.highlights && project.highlights.length > 0 && (
                <ul class="highlights">
                    {project.highlights.map(h => (
                            <li class="highlight">
                                <span class="highlight-arrow">‚Ä∫</span>
                                {h}
                            </li>
                    ))}
                </ul>
        )}

        <div class="card-footer">
            <div class="tags">
                {project.tags.slice(0, 4).map(tag => (
                        <span class="tag">{tag}</span>
                ))}
            </div>
            <div class="card-footer-right">
                {project.links && Object.keys(project.links).length > 0 && (
                        <div class="card-links">
                            {project.links.github && <span class="link-btn" data-href={project.links.github}>GitHub</span>}
                            {project.links.demo && <span class="link-btn accent" data-href={project.links.demo}>Demo</span>}
                            {project.links.store && <span class="link-btn accent" data-href={project.links.store}>Store</span>}
                        </div>
                )}
                <span class="view-project">View Project ‚Üí</span>
            </div>
        </div>
    </div>
    <div class="card-glow"></div>
</a>

<script>
    document.querySelectorAll<HTMLElement>('.link-btn[data-href]').forEach(btn => {
        btn.addEventListener('click', e => {
            e.preventDefault();
            e.stopPropagation();
            window.open(btn.dataset.href, '_blank', 'noopener');
        });
    });
</script>

<style>
    .project-card {
        position: relative;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: var(--surface);
        overflow: hidden;
        transition: transform 0.3s ease, border-color 0.3s ease;
        cursor: pointer;
        height: 100%;
        text-decoration: none;
        display: block;
        color: inherit;
    }

    .project-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--accent), transparent);
        opacity: 0;
        transition: opacity 0.4s;
    }

    .project-card:hover {
        transform: translateY(-4px);
        border-color: var(--border-glow);
    }

    .project-card:hover::before { opacity: 1; }

    .project-card.featured {
        border-color: var(--border-glow);
        background: var(--surface-2);
    }

    .project-card.featured::before { opacity: 0.5; }

    .card-inner {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        height: 100%;
        position: relative;
        z-index: 1;
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .category-icon { font-size: 1.2rem; }

    .languages {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
    }

    .card-title {
        font-family: var(--font-display);
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
        line-height: 1.3;
    }

    .project-card.featured .card-title {
        font-size: 1.25rem;
        background: linear-gradient(135deg, var(--text), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .card-desc {
        font-size: 0.88rem;
        color: var(--text-dim);
        line-height: 1.6;
        flex: 1;
    }

    .highlights {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .highlight {
        font-family: var(--font-mono);
        font-size: 0.72rem;
        color: var(--accent-2);
        display: flex;
        gap: 0.4rem;
        align-items: flex-start;
    }

    .highlight-arrow {
        color: var(--accent);
        flex-shrink: 0;
    }

    .card-footer {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: auto;
        padding-top: 0.5rem;
        border-top: 1px solid var(--border);
    }

    .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.3rem;
    }

    .card-footer-right {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-shrink: 0;
    }

    .view-project {
        font-family: var(--font-mono);
        font-size: 0.7rem;
        color: var(--text-muted);
        letter-spacing: 0.05em;
        transition: color 0.2s;
        white-space: nowrap;
    }

    .project-card:hover .view-project {
        color: var(--accent);
    }
    display: flex;
    gap: 0.5rem;
    }

    .link-btn {
        font-family: var(--font-mono);
        font-size: 0.7rem;
        padding: 0.25rem 0.7rem;
        border: 1px solid var(--border);
        color: var(--text-dim);
        border-radius: 3px;
        transition: all 0.2s;
        text-decoration: none;
        letter-spacing: 0.05em;
    }

    .link-btn:hover, .link-btn.accent {
        border-color: var(--accent);
        color: var(--accent);
    }

    .card-glow {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 50% 0%, var(--accent-dim), transparent 70%);
        opacity: 0;
        transition: opacity 0.4s;
        pointer-events: none;
    }

    .project-card:hover .card-glow { opacity: 1; }
    .project-card.featured .card-glow { opacity: 0.5; }
</style>